<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bid Calculator</title>
    <style>
        /* Basic Styling */
        body { font-family: sans-serif; padding: 20px; background-color: #f4f4f4; }
        .calculator { background-color: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); max-width: 500px; margin: auto; }

        /* Logo Styling */
        .logo-image {
            display: block;
            margin-left: auto;
            margin-right: auto;
            max-width: 280px;
            height: auto;
            margin-bottom: 25px;
        }

        .form-group { margin-bottom: 20px; }
        /* Adjust margins for conditionally hidden elements */
        .form-group:has(#estimatedHoursGroup:hidden),
        #updateDetails:has(#estimatedHoursGroup:hidden):has(#multiplierGroup:hidden) {
             margin-bottom: 0; padding-bottom: 0;
        }
        #estimatedHoursGroup, #multiplierGroup { margin-bottom: 20px; }

        label { display: block; margin-bottom: 8px; font-weight: bold; }
        input[type="number"], input[type="radio"], input[type="range"], input[type="checkbox"], button { padding: 10px; margin-bottom: 5px; border: 1px solid #ccc; border-radius: 4px; width: 95%; box-sizing: border-box; }
        input[type="radio"], input[type="checkbox"] { width: auto; margin-right: 5px; vertical-align: middle; padding: 0; margin-bottom: 0; }
        .inline-label { display: inline-block; font-weight: normal; margin-bottom: 10px; margin-right: 15px; }
        input[type="range"] { width: calc(85% - 60px); vertical-align: middle; margin-right: 10px; }

        /* Button Styling */
        button {
            background-color: #ed2025; /* Applied Brand Color */
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
            width: 100%;
        }
        button:hover {
            background-color: #c41a1e; /* Darker shade for hover */
        }

        #result { margin-top: 25px; font-size: 1.5em; font-weight: bold; text-align: center; padding: 15px; background-color: #e9ecef; border-radius: 4px; }
        .value-display { display: inline-block; font-weight: bold; min-width: 40px; text-align: right; }
        /* Default visibility for conditional sections */
        #additionalOptions, #updateOptions, #updateDetails, #multiplierGroup {
            display: none;
            border-top: 1px solid #eee; margin-top: 20px; padding-top: 20px;
         }
         /* Remove extra separators/padding for nested/related groups */
         #updateOptions, #multiplierGroup { border-top: none; margin-top: 0; padding-top: 10px; }
         #updateDetails { border-top: none; margin-top: 0; padding-top: 10px; }
    </style>
</head>
<body>

<div class="calculator">

    <img src="https://www.diamondlandsurveying.com/wp-content/uploads/2019/01/logo-1.png" alt="Diamond Land Surveying Logo" class="logo-image">

    <h2>Survey Bid Calculator</h2>

    <div class="form-group">
        <label>Survey Type:</label>
        <input type="radio" id="baseAlta" name="surveyType" value="2500" checked onchange="toggleConditionalSections()">
        <label for="baseAlta" class="inline-label">Base ALTA</label><br>
        <input type="radio" id="altaTopo" name="surveyType" value="4000" onchange="toggleConditionalSections()">
        <label for="altaTopo" class="inline-label">ALTA with TOPO</label><br>
        <input type="radio" id="altaUpdateNew" name="surveyType" value="3500" onchange="toggleConditionalSections()">
        <label for="altaUpdateNew" class="inline-label">ALTA Update New Title Co</label><br>
        <input type="radio" id="altaUpdateSame" name="surveyType" value="3000" onchange="toggleConditionalSections()">
        <label for="altaUpdateSame" class="inline-label">ALTA Update Same Title Co</label>
    </div>

    <div class="form-group">
        <label for="acreage">Acreage:</label>
        <input type="number" id="acreage" name="acreage" min="0" step="0.01" placeholder="e.g., 5.25" required>
    </div>

    <div id="additionalOptions">
        <h4>Additional Options</h4>
        <div class="form-group">
            <label for="corners">Number of Property Corners:</label>
            <input type="number" id="corners" name="corners" min="0" step="1" value="0" placeholder="e.g., 4">
        </div>
        <div class="form-group">
            <label for="vegetation">High Vegetation Percentage:</label>
            <input type="range" id="vegetation" name="vegetation" min="0" max="10" value="0" step="1">
            <span id="vegetationValue" class="value-display">0%</span>
        </div>
        <div class="form-group">
            <label>Service Area:</label>
            <input type="radio" id="areaGreen" name="serviceArea" value="1.0" checked>
            <label for="areaGreen" class="inline-label">Green</label>
            <input type="radio" id="areaYellow" name="serviceArea" value="1.1">
            <label for="areaYellow" class="inline-label">Yellow</label>
            <input type="radio" id="areaRed" name="serviceArea" value="1.25">
            <label for="areaRed" class="inline-label">Red</label>
        </div>
    </div>

    <div id="updateOptions">
        <h4>Update Options</h4>
        <div class="form-group">
            <label>Does Update Require Field Work?</label>
            <input type="radio" id="fieldWorkNo" name="fieldWorkRequired" value="no" checked onchange="toggleUpdateDetails()">
            <label for="fieldWorkNo" class="inline-label">No</label>
            <input type="radio" id="fieldWorkYes" name="fieldWorkRequired" value="yes" onchange="toggleUpdateDetails()">
            <label for="fieldWorkYes" class="inline-label">Yes</label>
        </div>
        <div id="updateDetails">
            <div class="form-group">
                <input type="checkbox" id="dueDiligence" name="dueDiligence" onchange="toggleHoursAndMultiplierVisibility()">
                <label for="dueDiligence" class="inline-label">Due Diligence Visit</label>
            </div>
            <div class="form-group" id="estimatedHoursGroup">
                <label for="estimatedHours">Estimated Hours:</label>
                <input type="number" id="estimatedHours" name="estimatedHours" min="0" step="0.1" value="0" placeholder="e.g., 2.5">
            </div>
        </div>
    </div>

    <div class="form-group" id="multiplierGroup">
        <label for="multiplier">Multiplier (0-10):</label>
        <input type="range" id="multiplier" name="multiplier" min="0" max="10" value="0" step="1">
        <span id="multiplierValue" class="value-display">0</span>
    </div>

    <button type="button" onclick="calculateBid()">Calculate Bid</button>

    <div id="result">
        Your estimated bid cost will appear here.
    </div>
</div>

<script>
    // --- Get References to Elements ---
    const multiplierSlider = document.getElementById('multiplier');
    const multiplierValueDisplay = document.getElementById('multiplierValue');
    const multiplierGroup = document.getElementById('multiplierGroup');
    const vegetationSlider = document.getElementById('vegetation');
    const vegetationValueDisplay = document.getElementById('vegetationValue');
    const additionalOptionsDiv = document.getElementById('additionalOptions');
    const updateOptionsDiv = document.getElementById('updateOptions');
    const updateDetailsDiv = document.getElementById('updateDetails');
    const cornersInput = document.getElementById('corners');
    const acreageInput = document.getElementById('acreage');
    const dueDiligenceCheckbox = document.getElementById('dueDiligence');
    const estimatedHoursInput = document.getElementById('estimatedHours');
    const estimatedHoursGroup = document.getElementById('estimatedHoursGroup');

    // --- Event Listeners for Sliders ---
    multiplierSlider.oninput = function() { multiplierValueDisplay.textContent = this.value; }
    vegetationSlider.oninput = function() { vegetationValueDisplay.textContent = `${this.value * 10}%`; }

    // --- Functions to Show/Hide Conditional Sections ---
    function toggleHoursAndMultiplierVisibility() {
        const isDueDiligenceChecked = dueDiligenceCheckbox.checked;
        const isUpdateOptionsVisible = updateOptionsDiv.style.display === 'block';

        estimatedHoursGroup.style.display = isDueDiligenceChecked ? 'none' : 'block';

        if (isUpdateOptionsVisible) {
            multiplierGroup.style.display = isDueDiligenceChecked ? 'none' : 'block';
        }
    }

    function toggleUpdateDetails() {
        const fieldWorkYes = document.getElementById('fieldWorkYes').checked;
        if (fieldWorkYes) {
            updateDetailsDiv.style.display = 'block';
            toggleHoursAndMultiplierVisibility();
        } else {
            updateDetailsDiv.style.display = 'none';
            if (updateOptionsDiv.style.display === 'block') {
                 multiplierGroup.style.display = 'block'; // Ensure multiplier shows if field work=No
            }
        }
    }

    function toggleConditionalSections() {
        const selectedSurveyTypeElement = document.querySelector('input[name="surveyType"]:checked');
        additionalOptionsDiv.style.display = 'none';
        updateOptionsDiv.style.display = 'none';
        updateDetailsDiv.style.display = 'none';
        multiplierGroup.style.display = 'none';

        if (selectedSurveyTypeElement) {
            const selectedTypeId = selectedSurveyTypeElement.id;
            if (selectedTypeId === 'baseAlta' || selectedTypeId === 'altaTopo') {
                additionalOptionsDiv.style.display = 'block';
                multiplierGroup.style.display = 'block';
            } else if (selectedTypeId === 'altaUpdateNew' || selectedTypeId === 'altaUpdateSame') {
                updateOptionsDiv.style.display = 'block';
                toggleUpdateDetails(); // Manages details and multiplier visibility
            }
        }
    }

    // --- Main Calculation Function ---
    function calculateBid() {
        // 1. Get Base Values & Validate
        const baseCostElement = document.querySelector('input[name="surveyType"]:checked');
        if (!baseCostElement) {
             document.getElementById('result').innerText = "Please select a survey type.";
             return;
        }
        const baseCost = parseFloat(baseCostElement.value);
        const selectedSurveyTypeId = baseCostElement.id;
        const acreage = parseFloat(acreageInput.value);

        let userMultiplier = 0; // Default multiplier input value
        if (multiplierGroup.style.display === 'block') {
             userMultiplier = parseInt(multiplierSlider.value);
             // Validate only if visible and needed
             if (isNaN(userMultiplier) || userMultiplier < 0 || userMultiplier > 10) {
                 document.getElementById('result').innerText = "Invalid multiplier selected (must be 0-10).";
                 multiplierSlider.focus(); // Focus on the slider if invalid
                 return;
             }
        }

        if (isNaN(acreage) || acreage < 0) {
            document.getElementById('result').innerText = "Please enter a valid positive number for acreage.";
            acreageInput.focus(); return;
        }

        // --- Core Calculation ---
        // 2. Calculate Base Subtotal
        let acreageRate = (selectedSurveyTypeId === 'altaUpdateNew' || selectedSurveyTypeId === 'altaUpdateSame') ? 250 : 500;
        const acreageFee = acreageRate * acreage;
        const subtotal = baseCost + acreageFee;

        // 3. Initialize and Calculate Base/Topo Additional Costs
        let cornersCost = 0, vegetationAddOn = 0, serviceAreaMultiplier = 1.0;
        if (additionalOptionsDiv.style.display === 'block') {
            const cornersValue = parseInt(cornersInput.value);
            // Validate only if visible and needed
            if (isNaN(cornersValue) || cornersValue < 0) {
                 // Allow empty or 0, but show error for invalid characters or negative
                 if (cornersInput.value !== "" && cornersInput.value !== "0") {
                    document.getElementById('result').innerText = "Please enter a valid non-negative number for corners.";
                    cornersInput.focus(); return;
                 }
                 // If empty treat as 0
                 cornersCost = 0;
            } else {
                 cornersCost = 45 * cornersValue;
            }


            const vegetationSliderValue = parseInt(vegetationSlider.value);
            // Range slider inherently handles validation 0-10
            if (!isNaN(vegetationSliderValue)) vegetationAddOn = subtotal * (vegetationSliderValue * 0.025);

            const serviceAreaElement = document.querySelector('input[name="serviceArea"]:checked');
            if (serviceAreaElement) {
                serviceAreaMultiplier = parseFloat(serviceAreaElement.value);
                if (isNaN(serviceAreaMultiplier)) serviceAreaMultiplier = 1.0; // Safety default
            }
        }

        // 4. Calculate Adjusted Subtotal and Apply Service Area Multiplier
        const adjustedSubtotal = subtotal + cornersCost + vegetationAddOn;
        const preMultiplierTotal = adjustedSubtotal * serviceAreaMultiplier;

        // 5. Calculate Main Multiplier
        const calculationMultiplier = 1 + (userMultiplier / 10); // Defaults to 1.0 if multiplier hidden

        // 6. Calculate Core Bid Cost
        let coreBidCost = preMultiplierTotal * calculationMultiplier;

        // 7. Initialize and Calculate Update Add-on Costs
        let updateAddOnCost = 0;
        const fieldWorkRequired = (updateOptionsDiv.style.display === 'block') && document.getElementById('fieldWorkYes').checked;

        if (fieldWorkRequired) {
            if (dueDiligenceCheckbox.checked) {
                updateAddOnCost += 500;
            }
            // Calculate hours cost ONLY if the group is visible
            if (estimatedHoursGroup.style.display === 'block') {
                 const estimatedHours = parseFloat(estimatedHoursInput.value);
                 // Validate only if visible and needed
                 if (isNaN(estimatedHours) || estimatedHours < 0) {
                      // Allow empty or 0, but show error for invalid characters or negative
                      if (estimatedHoursInput.value !== "" && estimatedHoursInput.value !== "0") {
                         document.getElementById('result').innerText = "Please enter a valid non-negative number for estimated hours.";
                         estimatedHoursInput.focus(); return;
                      }
                      // If empty treat as 0
                      // No cost added if 0 or empty
                 } else {
                     updateAddOnCost += estimatedHours * 250;
                 }
            }
        }

        // 8. Calculate Final Cost
        const finalBidCost = coreBidCost + updateAddOnCost;

        // --- Display Result ---
        const formattedCost = finalBidCost.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
        document.getElementById('result').innerText = `Estimated Bid Cost: ${formattedCost}`;
    }

    // --- Initial Setup on Page Load ---
    multiplierValueDisplay.textContent = multiplierSlider.value;
    vegetationValueDisplay.textContent = `${vegetationSlider.value * 10}%`;
    toggleConditionalSections(); // Run once to set initial visibility

</script>

</body>
</html>